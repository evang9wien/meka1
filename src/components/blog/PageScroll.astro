---
import { getPermalink } from '~/utils/permalinks';
import Button from '~/components/ui/Button.astro';
import { twMerge } from 'tailwind-merge';

const { page, maxButtons } = Astro.props;

const pageCount = page.lastPage ? page.lastPage + 1 : 0;
const currentPage = page.currentPage;
const buttonCount = maxButtons ?? 3;
let firstButtonPage = currentPage - Math.floor((buttonCount / 2));

if (firstButtonPage < 1)
{
    firstButtonPage = 1;
}

let lastButtonPage = firstButtonPage + buttonCount - 1;

if (lastButtonPage >= pageCount)
{
    lastButtonPage = pageCount - 1;
    firstButtonPage = pageCount - buttonCount;
}

let pageNumbers = Array();
for (let pageNumber = firstButtonPage; pageNumber <= lastButtonPage; pageNumber++)
{
    pageNumbers.push(Math.round(pageNumber));
}

const rx = /(.*)\/[0-9]+/;
let basePath = page.url.current;

let matches = rx.exec(basePath);
if (matches !== null)
{
    basePath = matches[1];
}
let path = page.url.current;

function getPageUrl(basePath: String, pageNumber: number)
{
    if (pageNumber == 1)
    {
        return basePath;
    }
    return basePath + '/' + pageNumber.toString();
}

---

<!--<div class="max-w-xs sm:max-w-md m-auto flex flex-nowrap flex-col sm:flex-row sm:justify-left gap-4">-->
<div class="flex flex-nowrap flex-row -space-x-4 max-w-xs sm:max-w-md">
<!--    {firstButtonPage}, {currentPage}, {buttonCount / 2}, {Math.floor((buttonCount / 2))}, {lastButtonPage} -->
    <div class="inline">
        <Button variant="tertiary"
                href={ currentPage != 1 ? (
                        getPageUrl(getPermalink(basePath), 1)
                        ) : undefined
                    }
                icon="tabler:chevrons-left"
                class={twMerge("sm:mb-0", currentPage == 1 ? "text-muted cursor-default" : "")} />
    </div>
    <div class="inline">
        <Button variant="tertiary"
                href={ currentPage > 1 ? (
                        getPageUrl(getPermalink(basePath), currentPage - 1)
                        ) : undefined
                    }
                icon="tabler:chevron-left"
                class={twMerge("sm:mb-0", currentPage == 1 ? "text-muted cursor-default" : "")} />
    </div>
    {
        pageNumbers.map((pageNumber) => (
        <div class="inline">
            <Button variant="tertiary"
                    href={ pageNumber != currentPage ? (
                        getPageUrl(getPermalink(basePath), pageNumber)
                        ) : undefined
                    }
                    text={pageNumber.toString()}
                    class={twMerge("sm:mb-0", currentPage == pageNumber ? "text-muted cursor-default" : "")} />
        </div>
        ))
    }
    <div class="inline">
        <Button variant="tertiary"
                href={ currentPage > 1 ? (
                        getPageUrl(getPermalink(basePath), currentPage + 1)
                        ) : undefined
                    }
                icon="tabler:chevron-right"
                class={twMerge("sm:mb-0", currentPage == page.lastPage ? "text-muted cursor-default" : "")} />
    </div>
    <div class="inline">
        <Button variant="tertiary"
                href={ currentPage != page.lastPage ? (
                        getPageUrl(getPermalink(basePath), page.lastPage)
                        ) : undefined
                    }
                icon="tabler:chevrons-right"
                class={twMerge("sm:mb-0", currentPage == page.lastPage ? "text-muted cursor-default" : "")} />
    </div>

</div>
